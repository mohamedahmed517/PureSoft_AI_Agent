import os
import re
import base64
import requests
import openai
from flask_cors import CORS
from dotenv import load_dotenv
from collections import defaultdict
from datetime import date, timedelta
from flask import Flask, request, jsonify

load_dotenv()

app = Flask(__name__)
CORS(app, resources={r"/api/*": {"origins": "*"}})

# ==================== OpenAI Config ====================
OPENAI_API_KEY = os.environ.get("OPENAI_API_KEY")
if not OPENAI_API_KEY:
    raise ValueError("OPENAI_API_KEY Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù€ environment variables!")

client = openai.OpenAI(api_key=OPENAI_API_KEY)

# ==================== CSV Data (Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª) ====================
CSV_DATA = """product_id,sell_price,product_name_ar,category
1,74.5,Ø¯ÙˆÙ Ù‡Ø§Ù†Ø¯ ÙˆÙˆØ´ 450 Ù…Ù„,Ù‡Ø§Ù†Ø¯ ÙˆÙˆØ´
2,95,Ø¯Ø§Ø¨Ø± Ø§Ù…Ù„Ø§ ÙƒØ±ÙŠÙ… Ø´Ø¹Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ù„ØªÙƒØ«ÙŠÙ Ø§Ù„Ø´Ø¹Ø± Ø¨Ù†ÙØ³Ø¬Ù‰ 125 Ù…Ù„,ÙƒØ±ÙŠÙ… Ø´Ø¹Ø±
3,19.25,Ø¯Ø§Ø¨Ø± ÙØ§ØªÙŠÙƒØ§ Ø¬Ù„ Ø´Ø¹Ø± Ø³Ø¨Ù„Ø§Ø´ Ø§ÙÙŠÙƒØª Ø¨Ø±Ø·Ù…Ø§Ù† Ø§Ø²Ø±Ù‚ 100 Ù…Ù„,Ø¬Ù„ Ø´Ø¹Ø±
5,91,Ø§Ù†Ø´Ø§Ù†ØªØ± Ø³Ø¨Ø±Ø§Ù‰ Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø§Ù„ÙˆØ±ÙŠÙ†Ø¬ Ù…ÙˆÙ 75 Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
8,91,Ø§Ù†Ø´Ø§Ù†ØªØ± Ø³Ø¨Ø±Ø§Ù‰ Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø´Ø§Ø±Ù…ÙŠÙ†Ø¬ Ø§ØµÙØ± 75 Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
9,12.75,ÙƒØ±ÙŠØ³ØªØ§Ù„ Ø¬Ù„ 500 Ø¬Ù…,Ø¬Ù„ Ø´Ø¹Ø±
10,20.5,ÙƒØ±ÙŠØ³ØªØ§Ù„ Ø´Ø§ÙˆØ± Ø¬Ù„ 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
11,31.25,ÙƒØ§Ù…Ù‰ ØµØ§Ø¨ÙˆÙ† ÙÙ†ØªØ§Ø¬ 120*4 Ø®ØµÙ… 15 %,ØµØ§Ø¨ÙˆÙ†
12,115,Ø¬ÙŠÙ„ÙŠØª ÙÙŠÙ†ÙˆØ³ 2 Ø´ÙØ±Ø© ÙƒÙŠØ³ 4 Ù…Ø§ÙƒÙŠÙ†Ø©,Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ø­Ù„Ø§Ù‚Ø©
13,260,Ù‡ÙŠØ¯ Ø§Ù†Ø¯ Ø´ÙˆÙ„Ø¯Ø±Ø² Ø´Ø§Ù…Ø¨Ùˆ Ø§Ù†ØªØ¹Ø§Ø´ Ø§Ù„Ù„ÙŠÙ…ÙˆÙ† 400 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
14,123.25,Ù‡ÙŠØ¯ Ø§Ù†Ø¯ Ø´ÙˆÙ„Ø¯Ø±Ø² Ø¨Ù„Ø³Ù… Ù…Ù†Ø¹Ø´ Ù†Ø¹Ù†Ø§Ø¹ 360 Ù…Ù„,Ø¨Ù„Ø³Ù…
15,260,Ù‡ÙŠØ¯ Ø§Ù†Ø¯ Ø´ÙˆÙ„Ø¯Ø±Ø² Ø´Ø§Ù…Ø¨Ùˆ Ù†Ø¸ÙŠÙ ÙˆØ§Ù†ÙŠÙ‚ 400 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
16,281.25,Ø¬ÙŠÙ„ÙŠØª Ù…Ø§Ùƒ Ø«Ø±Ù‰ Ø¬Ù„ Ø­Ù„Ø§Ù‚Ø© Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ†Ø§Ø¹Ù…Ø© 200 Ù…Ù„,Ø¬Ù„ Ø­Ù„Ø§Ù‚Ø©
17,30.25,ÙƒØ§Ù…Ù‰ ØµØ§Ø¨ÙˆÙ† 4Ã—120Ø¬Ù… Ø¬Ù…Ø§Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© Ø®ØµÙ… 15%,ØµØ§Ø¨ÙˆÙ†
20,43.5,Ø§ÙˆÙ„ÙˆÙŠØ² Ø§Ù„Ù…Ø§Ø³ÙŠØ© Ø§Ù„ØªØ±Ø§ Ù…ÙØ±Ø¯ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§ 7 ÙÙˆØ·Ø©,ÙÙˆØ· ØµØ­ÙŠØ©
21,65.25,Ø¨Ø§Ø±ÙˆØ¯ÙˆÙ†ØªÙƒØ³ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ø§Ù†ØªØ¹Ø§Ø´ Ø²Ø§Ø¦Ø¯75 Ø¬Ù…,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
23,170,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª Ø§Ù…ØªØ²Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© 180 Ù…Ù„,Ø¨Ø¯ÙŠÙ„ Ø²ÙŠØª
24,170,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª Ø¹Ù„Ø§Ø¬ Ù…Ù„ÙƒÙ‰ Ù„Ù„ØªÙ„Ù 180 Ù…Ù„,Ø¨Ø¯ÙŠÙ„ Ø²ÙŠØª
27,32.75,ÙƒØ§Ù…Ù‰ 2 ØµØ§Ø¨ÙˆÙ†Ø© ÙÙ†ØªØ§Ø¬ 175 Ø¬Ù… Ø¹Ø±Ø¶ 10%Ø®ØµÙ…,ØµØ§Ø¨ÙˆÙ†
28,23,Ø§ÙŠÙØ§ Ø³Ø¨ÙˆØªÙ„Ø³ ØµØ§Ø¨ÙˆÙ† 20Ø¬Ø±Ø§Ù…,ØµØ§Ø¨ÙˆÙ†
29,34.25,ÙƒØ±Ø³Øª Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† ÙƒÙˆÙ…Ø¨Ù„ÙŠØª 100 Ù…Ù„ +ÙƒØ±Ø³Øª 50 Ù…Ù„,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
30,89,Ø³Ø¨Ø§Ø±ÙƒÙ„ Ø´Ø§Ù…Ø¨Ùˆ Ùˆ Ø¨Ù„Ø³Ù… Ø´Ø¹Ø± Ø¹Ø§Ø¯Ù‰ Ø§Ø­Ù…Ø± 700 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
34,58.5,Ø¬ÙŠÙ„ÙŠØª Ø¨Ù„Ùˆ Ø«Ø±Ù‰ Ù…Ø§ÙƒÙŠÙ†Ø© 1 Ù…ÙˆØ³,Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ø­Ù„Ø§Ù‚Ø©
35,290,Ø²ÙŠØ±Ùˆ ÙØ±ÙŠØ² Ø¨Ù„Ø³Ù… Ù†Ø¹ÙˆÙ…Ø© Ø§Ù„Ø´Ø¹Ø± 355Ù…Ù„,Ø¨Ù„Ø³Ù…
36,300,Ø¬ÙŠÙ„ÙŠØª Ù…Ø§Ùƒ Ø«Ø±Ù‰ Ù…Ø§ÙƒÙŠÙ†Ø© 2 Ù…ÙˆØ³,Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ø­Ù„Ø§Ù‚Ø©
37,104.25,Ù‡ÙŠØ¯ Ø§Ù†Ø¯ Ø´ÙˆÙ„Ø¯Ø±Ø² Ø´Ø§Ù…Ø¨Ùˆ Ù†Ø¹Ù†Ø§Ø¹ Ù…Ù†Ø¹Ø´ 700 Ù…Ù„ + 100 Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª Ù…Ø¬Ø§Ù†Ø§,Ø´Ø§Ù…Ø¨Ùˆ
38,210.25,Ø¨Ø§Ù†ØªÙŠÙ† Ø´Ø§Ù…Ø¨Ùˆ Ø¶Ø¯ ØªØ³Ø§Ù‚Ø· Ø§Ù„Ø´Ø¹Ø± 400 Ù…Ù„ Ø®ØµÙ… 15%,Ø´Ø§Ù…Ø¨Ùˆ
39,104.25,Ù‡ÙŠØ¯ Ø§Ù†Ø¯ Ø´ÙˆÙ„Ø¯Ø±Ø² Ø´Ø§Ù…Ø¨Ùˆ Ù†Ø¸ÙŠÙ ÙˆØ§Ù†ÙŠÙ‚ 700Ù…Ù„+ Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª 100 Ù…Ù„ Ù…Ø¬Ø§Ù†Ø§,Ø´Ø§Ù…Ø¨Ùˆ
40,33.75,Ù‡ÙŠØ¯ Ø§Ù†Ø¯ Ø´ÙˆÙ„Ø¯Ø±Ø² Ø´Ø§Ù…Ø¨Ùˆ Ù†Ø¹Ù†Ø§Ø¹ Ù…Ù†Ø¹Ø´ 90 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
41,39.25,ÙØ§ÙŠÙ† Ù…Ø·Ø¨Ø® Ø¨ÙƒØ± 2 Ø±ÙˆÙ„,Ù…Ù†Ø§Ø¯ÙŠÙ„ Ù…Ø·Ø¨Ø®
42,247.25,Ø¨Ø§Ù†ØªÙŠÙ† Ø´Ø§Ù…Ø¨Ùˆ Ø¹Ù„Ø§Ø¬ Ù…Ù„ÙƒÙ‰ 400 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
43,160,Ø¯ÙˆÙ Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª Ø¶Ø¯ ØªØ³Ø§Ù‚Ø· Ø§Ù„Ø´Ø¹Ø± 300 Ù…Ù„,Ø¨Ø¯ÙŠÙ„ Ø²ÙŠØª
44,160,Ø¯ÙˆÙ Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª Ø§ØµÙ„Ø§Ø­ Ù…ÙƒØ«Ù 300 Ù…Ù„,Ø¨Ø¯ÙŠÙ„ Ø²ÙŠØª
45,17.75,ÙƒÙ„ÙˆØ³ Ø§Ø¨ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ø§Ø­Ù…Ø± 25 Ø¬Ù…,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
46,17.75,ÙƒÙ„ÙˆØ³ Ø§Ø¨ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ø§Ø®Ø¶Ø± 25 Ø¬Ù…,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
47,57,ÙƒÙ„ÙˆØ³ Ø§Ø¨ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ø§Ø­Ù…Ø± 100 Ø¬Ù…,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
48,57,ÙƒÙ„ÙˆØ³ Ø§Ø¨ Ù„ÙŠÙ…ÙˆÙ† ÙˆÙ†Ø¹Ù†Ø§Ø¹ Ø§ØµÙØ± 100 Ù…Ù„,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
49,57,ÙƒÙ„ÙˆØ³ Ø§Ø¨ ÙØ§ÙŠØ±+ ÙØ±ÙŠØ² Ø§ÙƒØ³ØªØ±ÙŠÙ… ÙƒÙˆÙ„ 100 Ù…Ù„,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
50,80.25,ÙƒÙ„ÙˆØ³ Ø§Ø¨ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† ÙˆØ§ÙŠØª Ù†Ø§Ùˆ 75 Ù…Ù„,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
51,16.25,Ø³ÙŠØ¬Ù†Ø§Ù„ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ù…ÙƒØ§ÙØ­ Ø§Ù„ØªØ³ÙˆØ³ 25 Ù…Ù„ Ø®ØµÙ… 25%,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
52,32.5,Ø³ÙŠØ¬Ù†Ø§Ù„ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† ØªÙØ§Ø­ Ø§Ø®Ø¶Ø± 50 Ù…Ù„ Ø®ØµÙ… 15 %,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
53,62,Ø³ÙŠØ¬Ù†Ø§Ù„ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ù…ÙƒØ§ÙØ­ Ø§Ù„ØªØ³ÙˆØ³ 120 Ù…Ù„ + 3 Ù‚Ù„Ù… Ù‡Ø¯ÙŠØ©,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
54,80.5,Ø³ÙŠØ¬Ù†Ø§Ù„ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† Ø§Ù„Ø­Ø³Ø§Ø³Ø© ÙØ±ÙŠØ´ 75 Ù…Ù„,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
55,67,Ø³ÙŠØ¬Ù†Ø§Ù„ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ø³Ù†Ø§Ù† ÙƒÙˆÙ…Ø¨Ù„ÙŠØª 8 Ø§ÙƒØ´Ù† 100 Ù…Ù„,Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†
56,105,Ø¯ÙˆÙ Ø±ÙˆÙ„ Ø§ÙˆÙ† Ø¨ÙˆØ¯Ø± Ø³ÙˆÙØª 50 Ù…Ù„,Ø±ÙˆÙ„ Ø§ÙˆÙ†
57,205,Ø§ÙƒØ³ Ø³Ø¨Ø±Ø§Ù‰ Ø¨Ù„Ø§Ùƒ Ø±Ø¬Ø§Ù„Ù‰ 150 Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
58,177,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø³Ø¨Ø±Ø§Ù‰ Ø­Ø±ÙŠÙ…Ù‰ Ø¨Ø§Ù…Ø¨Ùˆ 150 Ù…Ù„ Ø®ØµÙ… 10 Ø¬Ù†ÙŠØ©,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
59,158,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø³Ø¨Ø±Ø§Ù‰ Ø¨Ø§ÙˆØ¯Ø± Ø­Ø±ÙŠÙ…Ù‰ 150 Ù…Ù„ Ø®ØµÙ… 15 %,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
60,158,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø³Ø¨Ø±Ø§Ù‰ Ø´Ø§ÙˆØ± ÙƒÙ„ÙŠÙ† Ø­Ø±ÙŠÙ…Ù‰ 150 Ù…Ù„ Ø®ØµÙ… 15 %,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
61,158,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø³Ø¨Ø±Ø§Ù‰ Ø³Ø¨ÙˆØ±Øª Ø¯ÙŠÙÙ†Ø³ Ø±Ø¬Ø§Ù„Ù‰ 150 Ù…Ù„ Ø®ØµÙ… 15 %,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
62,158,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø³Ø¨Ø±Ø§Ù‰ Ø§ÙƒØ³ØªØ±Ø§ ÙƒÙˆÙ„ Ø±Ø¬Ø§Ù„Ù‰ 150 Ù…Ù„ Ø®ØµÙ… 15 %,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
63,150,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø³Ø¨Ø±Ø§Ù‰ V8 Ø±Ø¬Ø§Ù„Ù‰ 150 Ù…Ù„ Ø®ØµÙ… 20 %,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
64,43.75,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ù„Ø³Ù… Ù…Ù„ÙƒÙ‰ Ø´Ø¹Ø± ØªØ§Ù„Ù 200 Ù…Ù„ Ø®ØµÙ… 15%,Ø¨Ù„Ø³Ù…
65,43.75,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ù„Ø³Ù… Ø¶Ø¯ ØªØ³Ø§Ù‚Ø· Ø§Ù„Ø´Ø¹Ø± 200 Ù…Ù„ Ø®ØµÙ… 15%,Ø¨Ù„Ø³Ù…
66,43.75,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ù„Ø³Ù… Ø§Ù†Ø³ÙŠØ§Ø¨Ù‰ ÙˆØ­Ø±ÙŠØ±Ù‰ 200 Ù…Ù„ Ø®ØµÙ… 15%,Ø¨Ù„Ø³Ù…
67,35,Ø¯ÙˆÙ ØµØ§Ø¨ÙˆÙ† Ø§Ø¨ÙŠØ¶ 90 Ø¬Ù… Ø®ØµÙ… 3 Ø¬Ù†ÙŠØ©,ØµØ§Ø¨ÙˆÙ†
68,149.5,Ø§Ù† Ù„ÙŠÙÙ† Ø¨Ù„Ø³Ù… ØªÙˆØª ÙˆØªÙØ§Ø­ 400 Ù…Ù„,Ø¨Ù„Ø³Ù…
69,149.5,Ø§Ù† Ù„ÙŠÙÙ† Ø¨Ù„Ø³Ù… ÙƒÙŠÙˆÙ‰ 400 Ù…Ù„,Ø¨Ù„Ø³Ù…
70,149.5,Ø§Ù† Ù„ÙŠÙÙ† Ø´Ø§Ù…Ø¨Ùˆ ÙˆØ¨Ù„Ø³Ù… 2*1 400 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
71,149.5,Ø§Ù† Ù„ÙŠÙÙ† Ø´Ø§Ù…Ø¨Ùˆ ÙˆØ¨Ù„Ø³Ù… Ø±Ø¬Ø§Ù„Ù‰ Ø§Ø³ÙˆØ¯ 400 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
72,40,Ù„ÙˆÙƒØ³ ØµØ§Ø¨ÙˆÙ† 90 Ø¬Ù… Ø¹Ø±Ø¶ 6 Ù‚Ø·Ø¹ Ø®ØµÙ… 1 Ø¬Ù†ÙŠØ©,ØµØ§Ø¨ÙˆÙ†
73,98.25,Ø¨ÙŠÙˆ Ù…Ø§Ø³Ùƒ ÙØ­Ù… Ø§Ù†Ø¨ÙˆØ¨Ø© 150 Ù…Ù„,Ù…Ø§Ø³Ùƒ Ø´Ø¹Ø±
74,45.5,Ù‡ÙŠØ±Ø¯Ùˆ Ø´Ø§ÙˆØ± Ø¬Ù„ ÙƒÙˆÙ„Ø§Ø¬ÙŠÙ† ÙˆØ²Ø¨Ø¯Ø© Ø§Ù„Ø´ÙŠØ§ 1.25 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
75,212.25,Ù‡Ø§Ø±Ø¨ÙŠÙƒ Ù…Ù†Ø¸Ù Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙŠØ§Ø© Ø¨Ø§ÙˆØ± Ø§Ø³ÙˆØ¯ 700 Ù…Ù„,Ù…Ù†Ø¸ÙØ§Øª
76,70.25,ÙÙŠØ¨ÙƒØ³ ÙƒØ±ÙŠÙ… Ø­Ø±ÙŠÙ…Ù‰ Ø§Ø­Ù…Ø± 25 Ø¬Ù… Ø®ØµÙ… 10%,ÙƒØ±ÙŠÙ… Ø´Ø¹Ø±
79,176.5,Ù…Ø§Ø´ ØµÙ† Ø¨Ù„ÙˆÙƒ 45 Ø¨Ø±ØªÙ‚Ø§Ù„Ù‰ 125 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
81,119.75,Ù…Ø§Ø´ ØµÙ† Ø¨Ù„ÙˆÙƒ 45 Ø¨Ø±ØªÙ‚Ø§Ù„Ù‰ 60 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
82,235.25,Ù…Ø§Ø´ ØµÙ† Ø¨Ù„ÙˆÙƒ 95 Ø§ØµÙØ± 125 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
83,158.25,Ù…Ø§Ø´ ØµÙ† Ø¨Ù„ÙˆÙƒ 95 Ø§ØµÙØ±60 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
85,95,Ù„ÙˆÙƒØ³ Ø´Ø§ÙˆØ± Ø¬Ù„ Ø§Ù‚ØªÙ†Ù‰ Ø§Ù„Ø¬Ù…Ø§Ù„ 500Ù…Ù„,Ø´Ø§ÙˆØ± Ø¬Ù„
91,175.25,Ø¯ÙˆÙ Ø´Ø§ÙˆØ± Ø¬Ù„ Ù…Ø³ØªÙˆØ±Ø¯ 200 Ù…Ù„,Ø´Ø§ÙˆØ± Ø¬Ù„
100,145,ÙƒÙ„ÙŠØ± Ø´Ø§Ù…Ø¨Ùˆ Ù†Ø¹ÙˆÙ…Ø© ÙˆÙ„Ù…Ø¹Ø§Ù† Ø­Ø±ÙŠÙ…Ù‰ Ø§Ø¨ÙŠØ¶ 360 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
111,150,Ø¯ÙˆÙ Ø´Ø§Ù…Ø¨Ùˆ Ø´Ø¹Ø± Ù…ØªØ³Ø§Ù‚Ø· 400 Ù…Ù„,Ø´Ø§Ù…Ø¨Ùˆ
114,15,ÙˆÙˆØ¯Ø² Ù…Ø¹Ø·Ø± Ø¬Ùˆ ÙŠØ§Ø³Ù…ÙŠÙ† Ø§Ø®Ø¶Ø± 300 Ù…Ù„,Ù…Ø¹Ø·Ø± Ø¬Ùˆ
115,15,ÙˆÙˆØ¯Ø² Ù…Ø¹Ø·Ø± Ø¬Ùˆ Ù…Ø³Ùƒ Ø¨Ù…Ø¨Ù‰ 300 Ù…Ù„,Ù…Ø¹Ø·Ø± Ø¬Ùˆ
116,15,ÙˆÙˆØ¯Ø² Ù…Ø¹Ø·Ø± Ø¬Ùˆ Ù†Ø³ÙŠÙ… Ø§Ù„Ø¨Ø­Ø± 300 Ù…Ù„,Ù…Ø¹Ø·Ø± Ø¬Ùˆ
117,13.75,ÙˆÙˆØ¯Ø² Ù…Ø¹Ø·Ø± Ø¬Ùˆ ØªÙØ§Ø­ Ø§Ø®Ø¶Ø± 300 Ù…Ù„,Ù…Ø¹Ø·Ø± Ø¬Ùˆ
134,113.5,Ù„ØªÙ„ ÙÙŠØ´ Ø¨Ø¨Ø±ÙˆÙ†Ø© Ø¨Ù„Ø§Ø³ØªÙŠÙƒ Ø¨ÙŠØ¯ 240 Ù…Ù„,Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„
135,31,Ù„ØªÙ„ ÙÙŠØ´ Ø­Ù„Ù…Ø©,Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„
136,56.75,Ù„ØªÙ„ ÙÙŠØ´ Ø³ÙƒØ§ØªØ© Ù…Ø´Ø¨Ùƒ,Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„
137,70,Ù„ØªÙ„ ÙÙŠØ´ Ø´ÙØ§Ø· Ø«Ø¯Ù‰,Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„
138,56.75,Ù„ØªÙ„ ÙÙŠØ´ Ø¹Ø¶Ø§Ø¶Ø© Ù…Ø§Ø¦ÙŠØ©,Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„
139,85,Ù„ØªÙ„ ÙÙŠØ´ Ø¨Ø¨Ø±ÙˆÙ†Ø© Ø¨Ù„Ø§Ø³ØªÙŠÙƒ Ø¨ÙŠØ¯ 150 Ù…Ù„,Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø£Ø·ÙØ§Ù„
153,115.5,Ø§Ù†Ø¬Ù„ Ø¨Ø±ÙØ§Ù† Ù„ÙØ² 50 Ù…Ù„,Ø¨Ø±ÙØ§Ù†
154,115.5,Ø§Ù†Ø¬Ù„ Ø¨Ø±ÙØ§Ù† Ù„ÙŠÙ†Ø² 50 Ù…Ù„,Ø¨Ø±ÙØ§Ù†
155,115.5,Ø§Ù†Ø¬Ù„ Ø¨Ø±ÙØ§Ù† Ù„ÙˆÙ„ÙŠØ³ 50 Ù…Ù„,Ø¨Ø±ÙØ§Ù†
157,115.5,Ø§Ù†Ø¬Ù„ Ø¨Ø±ÙØ§Ù† Ù„Ø¬Ø² 50 Ù…Ù„,Ø¨Ø±ÙØ§Ù†
158,115.5,Ø§Ù†Ø¬Ù„ Ø¨Ø±ÙØ§Ù† Ø¨ÙˆÙ…Ø¨ 50 Ù…Ù„,Ø¨Ø±ÙØ§Ù†
161,61,Ø¨ÙŠÙƒ Ø³Ø¨Ø±Ø§Ù‰ Ø³Ø¨ÙˆØ±Øª Ø­Ø±ÙŠÙ…Ù‰ 225 Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
162,61,Ø¨ÙŠÙƒ Ø³Ø¨Ø±Ø§Ù‰ Ø¨ÙŠÙ†Ùƒ Ù„ÙŠØ¯Ù‰ Ø­Ø±ÙŠÙ…Ù‰ 225 Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
175,643.25,Ø¬Ù„ÙˆÙƒÙˆØ¯ÙƒØªÙˆØ± Ø¬Ù‡Ø§Ø² Ù‚ÙŠØ§Ø³ Ø³ÙƒØ± + Ø¹Ù„Ø¨Ø© Ø´Ø±Ø§Ø¦Ø· 25 Ø´Ø±ÙŠØ·,Ø£Ø¬Ù‡Ø²Ø© Ø·Ø¨ÙŠØ©
179,2275,Ø±ÙˆØ² Ù…Ø§ÙƒØ³ Ø¬Ù‡Ø§Ø² Ù†Ø¨ÙŠÙˆÙ„Ø§ÙŠØ²Ø± Ø³ÙˆÙŠØ³Ø±Ù‰,Ø£Ø¬Ù‡Ø²Ø© Ø·Ø¨ÙŠØ©
195,127.5,Ø¯ÙŠØªÙˆÙ„ Ù‡Ø§Ù†Ø¯ ÙˆÙˆØ´ Ø¬Ø¯Ø¯Ù‰ Ù†Ø´Ø§Ø·Ùƒ Ø¨Ø±ØªÙ‚Ø§Ù„Ù‰ 200 Ù…Ù„,Ù‡Ø§Ù†Ø¯ ÙˆÙˆØ´
196,170.75,Ø¯ÙŠØªÙˆÙ„ Ù‡Ø§Ù†Ø¯ ÙˆÙˆØ´ Ø§Ù„Ø§ØµÙ„Ù‰ Ø§Ø®Ø¶Ø± 400 Ù…Ù„,Ù‡Ø§Ù†Ø¯ ÙˆÙˆØ´
203,29.5,Ø¨ÙˆÙ†ÙƒØ³ ÙŠØ¯ÙˆÙ‰ Ù„ÙŠÙ…ÙˆÙ† 1.5 ÙƒØ¬Ù…,Ù…Ù†Ø¸ÙØ§Øª
204,347.25,Ø§Ø±ÙŠØ§Ù„ Ø§ØªÙˆÙ…Ø§ØªÙŠÙƒ ÙŠØ§Ø³Ù…ÙŠÙ† 8.5 Ùƒ + 500 Ø¬Ù… Ù…Ø¬Ø§Ù†Ø§,Ù…Ù†Ø¸ÙØ§Øª
205,347.25,Ø§Ø±ÙŠØ§Ù„ Ø§ØªÙˆÙ…Ø§ØªÙŠÙƒ Ø¯Ø§ÙˆÙ†Ù‰ 8.5 Ùƒ + 500 Ø¬Ù… Ù…Ø¬Ø§Ù†Ø§,Ù…Ù†Ø¸ÙØ§Øª
206,53.75,Ø§ÙˆÙ„ÙˆÙŠØ² Ø§Ù„ØªØ±Ø§ Ø¯ÙˆØ¨Ù„ Ø·ÙˆÙŠÙ„ Ø§Ø­Ù…Ø± 16 + 2 ÙÙˆØ·Ø© Ù…Ø¬Ø§Ù†Ø§,ÙÙˆØ· ØµØ­ÙŠØ©
207,56.75,Ø§ÙˆÙ„ÙˆÙŠØ² Ù…Ø§ÙƒØ³Ù‰ Ø¯ÙˆØ¨Ù„ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§ Ø§Ø²Ø±Ù‚ 16+2 ÙÙˆØ·Ø© Ù…Ø¬Ø§Ù†Ø§Ù‹,ÙÙˆØ· ØµØ­ÙŠØ©
208,170,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª Ø¹Ù†Ø§ÙŠØ© Ù…Ø±Ø·Ø¨Ø© 180Ù…Ù„,Ø¨Ø¯ÙŠÙ„ Ø²ÙŠØª
209,170,Ø¨Ø§Ù†ØªÙŠÙ† Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø²ÙŠØª ØµØ­Ù‰ ÙˆÙ†Ø¸ÙŠÙ 180 Ù…Ù„,Ø¨Ø¯ÙŠÙ„ Ø²ÙŠØª
213,39.25,ÙÙŠØ±Ù‰ ØªÙØ§Ø­ Ø§Ø­Ù…Ø± 1 Ù„ØªØ±,Ù…Ù†Ø¸ÙØ§Øª
214,14.25,ÙÙŠØ±Ù‰ Ø§Ù„Ø§ØµÙ„Ù‰ 700 Ø¬Ù… 9%,Ù…Ù†Ø¸ÙØ§Øª
215,51,ÙÙŠØ±Ù‰ Ù„ÙŠÙ…ÙˆÙ† Ø§Ø®Ø¶Ø± 920 Ù…Ù„,Ù…Ù†Ø¸ÙØ§Øª
230,195,Ø¯ÙˆÙ Ø³Ø¨Ø±Ø§Ù‰ Ø®ÙŠØ§Ø± ÙˆØ´Ø§Ù‰ Ø§Ø®Ø¶Ø± 150Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
231,85,Ø±ÙŠÙƒØ³ÙˆÙ†Ø§ Ø§Ø¯ÙØ§Ù†Ø³ÙŠØ¯ Ø±ÙˆÙ„ Ø§ÙˆÙ† Ø´Ø§ÙˆØ± ÙØ±ÙŠØ´ Ø­Ø±ÙŠÙ…Ù‰ 50 Ù…Ù„,Ø±ÙˆÙ„ Ø§ÙˆÙ†
249,494.5,Ø¨Ø§Ù…Ø¨Ø±Ø² Ø¹Ù†Ø§ÙŠØ© Ù…Ù‚Ø§Ø³ 2 74 Ø­ÙØ§Ø¶Ø©,Ø­ÙØ§Ø¶Ø§Øª
250,205,Ø§ÙƒØ³ Ø³Ø¨Ø±Ø§Ù‰ Ø§ÙØ±ÙŠÙ‚ÙŠØ§ 150 Ù…Ù„,Ù…Ø²ÙŠÙ„ Ø¹Ø±Ù‚ Ø³Ø¨Ø±Ø§ÙŠ
251,105,Ø¯ÙˆÙ Ø±ÙˆÙ„ Ø§ÙˆÙ† Ø­Ø±ÙŠÙ…Ù‰ Ø®ÙŠØ§Ø± ÙˆØ´Ø§Ù‰ Ø§Ø®Ø¶Ø± 50Ù…Ù„,Ø±ÙˆÙ„ Ø§ÙˆÙ†
254,105,Ø¯ÙˆÙ Ø±ÙˆÙ„ Ø§ÙˆÙ† Ø§Ù„Ø§ØµÙ„Ù‰ Ø­Ø±ÙŠÙ…Ù‰ 50 Ù…Ù„,Ø±ÙˆÙ„ Ø§ÙˆÙ†
255,85,Ù†ÙŠÙÙŠØ§ Ø±ÙˆÙ„ Ø§ÙˆÙ† Ø§Ù†ÙÙŠØ²ÙŠØ¨Ù„ Ø§ÙˆØ±Ø¬ÙŠÙ†Ø§Ù„ Ø±Ø¬Ø§Ù„Ù‰ 50 Ù…Ù„ Ø®ØµÙ… 15%,Ø±ÙˆÙ„ Ø§ÙˆÙ†
257,95,Ù„ÙˆÙƒØ³ Ø´Ø§ÙˆØ± Ø¬Ù„ Ø³Ø­Ø± Ø§Ù„Ø¬Ù…Ø§Ù„ Ø¨Ù†ÙØ³Ø¬Ù‰ 500Ù…Ù„,Ø´Ø§ÙˆØ± Ø¬Ù„
258,95,Ù„ÙˆÙƒØ³ Ø´Ø§ÙˆØ± Ø¬Ù„ Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„Ù†Ø§Ø¹Ù… 500Ù…Ù„,Ø´Ø§ÙˆØ± Ø¬Ù„
259,25,Ù„Ø§ÙŠÙØ¨ÙˆÙ‰ ØµØ§Ø¨ÙˆÙ† Ø¹Ù†Ø§ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© 115Ø¬Ù… Ù‚Ø·Ø¹Ø©,ØµØ§Ø¨ÙˆÙ†
261,488.75,Ù†ÙŠÙÙŠØ§ ØµÙ† Ø¨Ù„ÙˆÙƒ Ø§Ø·ÙØ§Ù„ +50 200 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
262,513.75,Ù†ÙŠÙÙŠØ§ ØµÙ† Ø¨Ù„ÙˆÙƒ +50 200 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
263,348,Ù†ÙŠÙÙŠØ§ ØµÙ† Ø¨Ù„ÙˆÙƒ +30 200 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
264,436.25,Ù†ÙŠÙÙŠØ§ ØµÙ† Ø¨Ù„ÙˆÙƒ Ø¨Ø±ÙˆØªÙƒØª Ø§Ù†Ø¯ ÙØ±ÙŠØ´ Ø³Ø¨Ø±Ø§Ù‰ 30 200 Ù…Ù„,ØµÙ† Ø¨Ù„ÙˆÙƒ
265,520,Ù†ÙŠÙÙŠØ§ Ø§ÙØªØ± ØµÙ† Ù„ÙˆØ´Ù† 200 Ù…Ù„ Ø®ØµÙ… 25%,ØµÙ† Ø¨Ù„ÙˆÙƒ
290,29.25,Ø¨Ø±Ø§ÙŠÙØª Ù…Ø§ÙƒØ³Ù‰ Ø¨ÙˆÙƒÙŠØª Ø¹Ø§Ø¯Ù‰ 8 ÙÙˆØ·Ø©,ÙÙˆØ· ØµØ­ÙŠØ©
291,41.25,Ø¨Ø±Ø§ÙŠÙØª Ù…Ø§ÙƒØ³Ù‰ Ø¨ÙˆÙƒÙŠØª Ø³ÙˆØ¨Ø± 9 ÙÙˆØ·Ø©,ÙÙˆØ· ØµØ­ÙŠØ©
292,50,Ø¨Ø±Ø§ÙŠÙØª Ø§ÙƒØ³ØªØ±Ø§ Ø±Ù‚ÙŠÙ‚Ø© Ø¬Ø¯Ø§ Ø³ÙˆØ¨Ø± 8 ÙÙˆØ·Ø©,ÙÙˆØ· ØµØ­ÙŠØ©
293,134,Ø±ÙŠÙ„Ø§ÙƒØ³ ÙØ§Ù… Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ù…Ø±Ø§Ø© Ø¨Ø¹Ø¯ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© 20 ÙÙˆØ·Ø©,ÙÙˆØ· ØµØ­ÙŠØ©
294,82,Ø¨ÙŠÙˆØ± Ø´Ø§ÙˆØ± Ø¬Ù„ ÙŠØ§Ø³Ù…ÙŠÙ† 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
295,82,Ø¨ÙŠÙˆØ± Ø´Ø§ÙˆØ± Ø¬Ù„ Ø¨Ø±Ø§Ø¦Ø­Ø© Ø§Ù„ÙˆØ±Ø¯ 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
296,82,Ø¨ÙŠÙˆØ± Ø´Ø§ÙˆØ± Ø¬Ù„ Ø§Ø´Ø±Ø§Ù‚Ø© Ø§Ù„ØµØ¨Ø§Ø­ 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
297,82,Ø¨ÙŠÙˆØ± Ø´Ø§ÙˆØ± Ø¬Ù„ Ø¨Ø±Ø§Ø¦Ø­Ø© Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„Ø¹Ù†Ø¨Ø± 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
298,82,Ø¨ÙŠÙˆØ± Ø´Ø§ÙˆØ± Ø¬Ù„ Ø³Ù‡Ø± Ø§Ù„Ù„ÙŠØ§Ù„Ù‰ 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
299,82,Ø¨ÙŠÙˆØ± Ø´Ø§ÙˆØ± Ø¬Ù„ Ø¹Ø¨ÙŠØ± Ø§Ù„Ø²Ù‡ÙˆØ± Ø§Ù„Ø¨Ø±ÙŠØ© 1.5 Ù„ØªØ±,Ø´Ø§ÙˆØ± Ø¬Ù„
1001,720,Ø¬Ø§ÙƒÙŠØª Ø¬Ù„Ø¯ Ø§Ø³ÙˆØ¯ ØªÙ‚ÙŠÙ„ Ù…Ø¨Ø·Ù† ÙØ±Ùˆ,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1002,580,ÙƒÙˆØªØ´ÙŠ Ø¨ÙˆÙˆØª Ø´ØªÙˆÙŠ Ø¬Ù„Ø¯ Ø§Ø³ÙˆØ¯ Ø¹Ø§Ù„ÙŠ,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1003,420,Ø¨Ù„ÙˆÙØ± ØµÙˆÙ Ø§ÙˆÙØ± Ø³Ø§ÙŠØ² Ø±Ù…Ø§Ø¯ÙŠ,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1004,250,Ø·Ø§Ù‚ÙŠØ© ØµÙˆÙ Ù…Ø¹ ÙˆØ´Ø§Ø­ Ø·ÙˆÙŠÙ„,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1005,680,ÙƒÙˆØªØ´ÙŠ Ø´ØªÙˆÙŠ Ø¬Ù„Ø¯ Ø¨Ù†ÙŠ Ù…Ø¨Ø·Ù†,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1006,480,ØªØ±ÙŠÙ†Ø¬ Ø´ØªÙˆÙŠ Ù‚Ø·ÙŠÙØ© ÙƒØ­Ù„ÙŠ ÙƒØ§Ù…Ù„,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1007,350,Ø¬ÙˆØ§Ù†ØªÙŠ Ø¬Ù„Ø¯ Ù…Ø¨Ø·Ù†Ø© Ø³ÙˆØ¯Ø§,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1008,780,Ø¬Ø§ÙƒÙŠØª Ø¨Ø§Ø±ÙƒØ§ Ø§Ø®Ø¶Ø± Ø²ÙŠØªÙŠ Ø·ÙˆÙŠÙ„,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1009,520,Ù‡ÙˆØ¯ÙŠ Ø´ØªÙˆÙŠ Ù…Ø¨Ø·Ù† ÙØ±Ùˆ Ø¨ÙŠØ¬,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1010,390,ÙƒØ§Ø¨ ØµÙˆÙ Ø´ØªÙˆÙŠ ÙØ±Ùˆ Ø¯Ø§Ø®Ù„ÙŠ,Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
1011,380,Ø¬Ø§ÙƒÙŠØª Ø¬ÙŠÙ†Ø² Ù…Ø¨Ø·Ù† Ø®ÙÙŠÙ,Ù„Ø¨Ø³ Ø®Ø±ÙŠÙÙŠ
1012,320,ÙƒØ§Ø±Ø¯ÙŠØ¬Ø§Ù† ØµÙˆÙ Ø®ÙÙŠÙ Ø¨ÙŠØ¬,Ù„Ø¨Ø³ Ø®Ø±ÙŠÙÙŠ
1013,450,ÙƒÙˆØªØ´ÙŠ Ù†Øµ Ø´ØªÙˆÙŠ Ø±Ù…Ø§Ø¯ÙŠ,Ù„Ø¨Ø³ Ø®Ø±ÙŠÙÙŠ
1014,290,Ø³ÙƒØ§Ø±Ù ÙƒØ´Ù…ÙŠØ± Ø·ÙˆÙŠÙ„,Ù„Ø¨Ø³ Ø®Ø±ÙŠÙÙŠ
1015,180,ØªÙŠØ´ÙŠØ±Øª ÙƒÙ… Ø·ÙˆÙŠÙ„ Ù‚Ø·Ù† Ø§Ø¨ÙŠØ¶,Ù„Ø¨Ø³ Ø±Ø¨ÙŠØ¹ÙŠ
1016,220,Ù‚Ù…ÙŠØµ ÙƒÙ… Ø·ÙˆÙŠÙ„ Ù…ÙØªÙˆØ­ ÙƒØ­Ù„ÙŠ,Ù„Ø¨Ø³ Ø±Ø¨ÙŠØ¹ÙŠ
1017,350,Ø¬ÙŠÙ†Ø² Ø³Ù„ÙŠÙ… ÙØª Ø§Ø³ÙˆØ¯,Ù„Ø¨Ø³ Ø±Ø¨ÙŠØ¹ÙŠ
1018,380,ÙƒÙˆØªØ´ÙŠ Ø§Ø¨ÙŠØ¶ ÙƒÙ„Ø§Ø³ÙŠÙƒ Ù†Ø¶ÙŠÙ,Ù„Ø¨Ø³ Ø±Ø¨ÙŠØ¹ÙŠ
1019,130,ØªÙŠØ´ÙŠØ±Øª Ù‚Ø·Ù† Ø³Ø§Ø¯Ø© Ø§Ø¨ÙŠØ¶,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1020,150,ØªÙŠØ´ÙŠØ±Øª Ø¨ÙˆÙ„Ùˆ ÙƒØ­Ù„ÙŠ Ù†Ø§Ø¹Ù…,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1021,170,Ø´ÙˆØ±Øª Ø¨Ø±Ù…ÙˆØ¯Ø§ Ø±Ù…Ø§Ø¯ÙŠ Ù‚Ø·Ù†,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1022,140,Ø´ÙˆØ±Øª Ø¬ÙŠÙ†Ø² ÙØ§ØªØ­ Ù‚ØµÙŠØ±,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1023,95,Ø´Ø¨Ø´Ø¨ ØµÙŠÙÙŠ Ø§Ø³ÙˆØ¯ Ù…Ø±ÙŠØ­,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1024,120,ÙƒØ§Ø¨ ØµÙŠÙÙŠ Ø§Ø¨ÙŠØ¶ Ø®ÙÙŠÙ,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1025,280,Ù†Ø¸Ø§Ø±Ø© Ø´Ù…Ø³ Ø±Ø§ÙŠ Ø¨Ø§Ù† Ø§ØµÙ„ÙŠØ©,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1026,110,ØªÙŠØ´ÙŠØ±Øª Ø¨Ø¯ÙˆÙ† ÙƒÙ… Ø§Ø³ÙˆØ¯,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1027,160,Ù‚Ù…ÙŠØµ Ù‡Ø§ÙˆØ§ÙŠ ÙƒÙ… Ù‚ØµÙŠØ± Ù…Ù„ÙˆÙ†,Ù„Ø¨Ø³ ØµÙŠÙÙŠ
1028,135,Ø´ÙˆØ±Øª Ø³Ø¨Ø§Ø­Ø© Ø§Ø²Ø±Ù‚ Ù…Ø§Ø±ÙŠÙ†,Ù„Ø¨Ø³ ØµÙŠÙÙŠ"""

# ==================== IP & Location & Weather ====================
IPV4_PRIVATE = re.compile(r'^(127\.0\.0\.1|10\.|172\.(1[6-9]|2[0-9]|3[0-1])\.|192\.168\.)')

def is_private_ip(ip: str) -> bool:
    return bool(IPV4_PRIVATE.match(ip))

def get_user_ip() -> str:
    headers = ["CF-Connecting-IP", "True-Client-IP", "X-Real-IP", "X-Forwarded-For", "X-Client-IP", "Forwarded"]
    for h in headers:
        val = request.headers.get(h)
        if val:
            ips = [i.strip() for i in val.replace('"', '').split(",")]
            for ip in ips:
                if ip and not is_private_ip(ip):
                    return ip
    return request.remote_addr or "127.0.0.1"

def get_location(ip: str):
    try:
        r = requests.get(f"https://ipapi.co/{ip}/json/", timeout=8)
        r.raise_for_status()
        d = r.json()
        if d.get("error") or not d.get("city") or not d.get("latitude") or not d.get("longitude"):
            raise ValueError("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©")
        return {"city": d.get("city"), "lat": d.get("latitude"), "lon": d.get("longitude")}
    except:
        try:
            r = requests.get(f"https://ipwho.is/{ip}", timeout=8)
            r.raise_for_status()
            d = r.json()
            if not d.get("city") or not d.get("latitude") or not d.get("longitude"):
                return None
            return {"city": d.get("city"), "lat": d.get("latitude"), "lon": d.get("longitude")}
        except:
            return None

def fetch_weather(lat, lon):
    start = date.today()
    end = start + timedelta(days=13)
    url = (
        f"https://api.open-meteo.com/v1/forecast?"
        f"latitude={lat}&longitude={lon}"
        f"&daily=temperature_2m_max,temperature_2m_min,precipitation_sum"
        f"&start_date={start.isoformat()}&end_date={end.isoformat()}&timezone=auto"
    )
    try:
        r = requests.get(url, timeout=15)
        r.raise_for_status()
        return r.json()["daily"]
    except:
        return None

def suggest_outfit(temp, rain):
    if rain > 2.0: return "Ù…Ø·Ø± â€“ Ø®ÙØ¯ Ø´Ù…Ø³ÙŠØ©"
    if temp < 10: return "Ø¨Ø±Ø¯ Ø¬Ø¯Ù‹Ø§ â€“ Ø¬Ø§ÙƒÙŠØª ØªÙ‚ÙŠÙ„"
    if temp < 18: return "Ø¨Ø§Ø±Ø¯ â€“ Ø¬Ø§ÙƒÙŠØª Ø®ÙÙŠÙ"
    if temp < 26: return "Ù…Ø¹ØªØ¯Ù„ â€“ ØªÙŠØ´ÙŠØ±Øª ÙˆØ¬ÙŠÙ†Ø²"
    if temp < 32: return "Ø¯Ø§ÙØ¦ â€“ ØªÙŠØ´ÙŠØ±Øª Ø®ÙÙŠÙ"
    return "Ø­Ø± â€“ Ø´ÙˆØ±Øª ÙˆÙ…ÙŠØ§Ù‡ ÙƒØªÙŠØ±"

conversation_history = defaultdict(list)

def gemini_chat(messages):

    GEMINI_API_KEY = os.environ.get("GEMINI_API_KEY")
    url = f"https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key={GEMINI_API_KEY}"

    prompt_text = "\n".join([f"{m['role']}: {m['content']}" for m in messages])

    payload = {
        "temperature": 0.7,
        "maxOutputTokens": 1024,
        "candidateCount": 1,
        "prompt": {"text": prompt_text}
    }

    try:
        response = requests.post(url, json=payload, timeout=15)
        response.raise_for_status()
        data = response.json()
        return data.get("candidates", [{}])[0].get("content", "Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù…ÙÙŠØ´ Ø±Ø¯ Ù…Ù† Gemini")
    except requests.exceptions.HTTPError as e:
        print(f"Gemini HTTP Error: {e} â€“ {response.text}")
        return "Ø¹Ø°Ø±Ù‹Ø§ØŒ ÙƒÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø´ Ø´ØºØ§Ù„Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ"
    except Exception as e:
        print(f"Gemini Error: {e}")
        return "Ø¹Ø°Ø±Ù‹Ø§ØŒ ÙƒÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø´ Ø´ØºØ§Ù„Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ"

def openai_chat(messages):
    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=messages,
            temperature=0.7,
            max_tokens=1024
        )
        return response.choices[0].message.content.strip()
    except Exception as e:
        return gemini_chat(messages)


@app.route("/")
def home():
    return jsonify({
        "message": "PureSoft AI Backend Ø´ØºØ§Ù„ 100%",
        "api": "/api/chat",
        "frontend": "https://mohamedahmed517.github.io/PureSoft_Website/"
    })

@app.route("/api/chat", methods=["POST"])
def chat():
    try:
        user_ip = get_user_ip()
        location = get_location(user_ip)
        if not location:
            return jsonify({"error": "Ù…Ø´ Ø¹Ø§Ø±Ù Ø£Ø­Ø¯Ø¯ Ù…ÙƒØ§Ù†Ùƒ"}), 400

        city = location["city"]
        weather_data = fetch_weather(location["lat"], location["lon"])
        if not weather_data:
            return jsonify({"error": "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù‚Ø³"}), 500

        today = date.today()
        forecast_lines = []
        for i in range(min(14, len(weather_data["time"]))):
            d = (today + timedelta(days=i)).strftime("%d-%m")
            t_max = weather_data["temperature_2m_max"][i]
            t_min = weather_data["temperature_2m_min"][i]
            temp = round((t_max + t_min) / 2, 1)
            rain = weather_data["precipitation_sum"][i]
            outfit = suggest_outfit(temp, rain)
            forecast_lines.append(f"{d}: {temp}Â°C â€“ {outfit}")

        forecast_text = "\n".join(forecast_lines)

        user_message = request.form.get("message", "").strip()
        image_file = request.files.get("image")
        image_b64 = None
        if image_file:
            if not image_file.filename.lower().endswith(('.png', '.jpg', '.jpeg', '.webp')):
                return jsonify({"error": "Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø´ Ù…Ø¯Ø¹ÙˆÙ…"}), 400
            if image_file.content_length > 5 * 1024 * 1024:
                return jsonify({"error": "Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© Ø£ÙˆÙŠ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 Ù…ÙŠØ¬Ø§)"}), 400
            image_b64 = base64.b64encode(image_file.read()).decode('utf-8')

        if not user_message and not image_b64:
            return jsonify({"error": "Ù„Ø§Ø²Ù… ØªØ¨Ø¹Øª Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ ØµÙˆØ±Ø©"}), 400

        history = conversation_history[user_ip]

        messages = [
                    {"role": "system", "content": f"""
        Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ù…ØµØ±ÙŠ Ø°ÙƒÙŠ ÙˆÙˆØ¯ÙˆØ¯ Ø¬Ø¯Ù‹Ø§ØŒ Ø¨ØªØªÙƒÙ„Ù… Ø¹Ø§Ù…ÙŠØ© Ù…ØµØ±ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ© 100%ØŒ Ù…Ù…ØªØ¹ ÙˆØµØ±ÙŠØ­ ÙˆØ¨ØªÙÙ‡Ù… Ø§Ù„ÙŠÙˆØ²Ø± Ù…Ù† Ù†Øµ ÙƒÙ„Ù…Ø©.

        Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ù†Ø§ (Ù„Ø§Ø²Ù… ØªØ±Ø´Ø­ Ù…Ù†Ù‡Ù… ÙÙ‚Ø· Ù„Ùˆ Ø·Ù„Ø¨ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ù„Ù„Ø¨ÙŠØ¹):
        {CSV_DATA}

        ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù‚Ø³ ÙÙŠ {city} Ù„Ù…Ø¯Ø© 14 ÙŠÙˆÙ…:
        {forecast_text}

        â˜…â˜…â˜…â˜…â˜… Ù‚ÙˆØ§Ø¹Ø¯ ØµØ§Ø±Ù…Ø© Ø¬Ø¯Ù‹Ø§ â˜…â˜…â˜…â˜…â˜…
        1. Ø£ÙˆÙ„ Ø±Ø¯ Ø¨Ø³: Ø±Ø­Ø¨ Ø¨Ø³ÙŠØ· + Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø·Ù‚Ø³ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ.
        2. Ø¨Ø¹Ø¯Ù‡Ø§ Ù…Ø§ ØªØ¹ÙŠØ¯Ø´ Ø§Ù„Ø·Ù‚Ø³ Ø£Ø¨Ø¯Ù‹Ø§ Ø¥Ù„Ø§ Ù„Ùˆ Ø³Ø£Ù„ ØµØ±Ø§Ø­Ø©.
        3. Ù„Ùˆ Ø±ÙØ¹ ØµÙˆØ±Ø© â†’ Ø­Ù„Ù„Ù‡Ø§ ÙƒÙˆÙŠØ³ (Ù„Ø¨Ø³ØŒ Ø¨Ø´Ø±Ø©ØŒ Ø´Ø¹Ø±ØŒ Ù…ÙƒØ§Ù†ØŒ Ø¬Ùˆ...) ÙˆØ±Ø´Ø­ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø©.
        4. â˜…â˜…â˜… Ø£Ù‡Ù… Ø­Ø§Ø¬Ø© â˜…â˜…â˜…
        ÙƒÙ„ Ù…Ø§ ØªØ±Ø´Ø­ Ø£ÙŠ Ù…Ù†ØªØ¬ (ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ø£ÙƒØªØ±)ØŒ Ù„Ø§Ø²Ù… ØªÙƒØªØ¨ ÙƒÙ„ Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø¯Ù‡ Ø¨Ø§Ù„Ø¸Ø¨Ø· ÙˆÙ…Ø§ ÙŠÙ†ÙØ¹Ø´ ØªØºÙŠØ± Ø§Ù„ØªØ±ØªÙŠØ¨ Ø£Ø¨Ø¯Ù‹Ø§:

        ğŸ›ï¸ **Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬**
        ğŸ’° Ø§Ù„Ø³Ø¹Ø±: xxx Ø¬Ù†ÙŠÙ‡
        ğŸ“‚ Ø§Ù„ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ: ÙƒØ°Ø§
        ğŸ”— Ø§Ù„Ù„ÙŠÙ†Ùƒ: https://afaq-stores.com/product-details/{{id}}

        Ù…Ø«Ø§Ù„:
        ğŸ›ï¸ **Ø¬Ø§ÙƒÙŠØª Ø¬Ù„Ø¯ Ø§Ø³ÙˆØ¯ ØªÙ‚ÙŠÙ„ Ù…Ø¨Ø·Ù† ÙØ±Ùˆ**
        ğŸ’° Ø§Ù„Ø³Ø¹Ø±: 720 Ø¬Ù†ÙŠÙ‡
        ğŸ“‚ Ø§Ù„ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ: Ù„Ø¨Ø³ Ø´ØªÙˆÙŠ
        ğŸ”— Ø§Ù„Ù„ÙŠÙ†Ùƒ: https://afaq-stores.com/product-details/1001

        5. Ù„Ùˆ ÙÙŠÙ‡ Ø¹Ø±Ø¶ Ø£Ùˆ Ø®ØµÙ… â†’ Ø§Ø°ÙƒØ±Ù‡ Ø¨ÙˆØ¶ÙˆØ­ Ø¬Ù†Ø¨ Ø§Ù„Ø³Ø¹Ø±.
        6. Ù„Ùˆ Ø§Ù„ÙŠÙˆØ²Ø± Ø¹Ø§ÙŠØ² ÙŠÙ‚Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØª â†’ Ø§Ù‚ØªØ±Ø­ Ù†Ø´Ø§Ø·Ø§Øª Ø¨ÙŠØªÙŠØ© ÙˆÙ…Ø§ ØªØ­ÙØ²Ø´ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø£Ø¨Ø¯Ù‹Ø§.
        7. Ø±Ø¯ÙˆØ¯Ùƒ Ø¯Ø§ÙŠÙ…Ù‹Ø§ Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¬Ø¯Ù‹Ø§ Ø²ÙŠ Ø§Ù„Ø¨Ù†ÙŠ Ø¢Ø¯Ù…ÙŠÙ†ØŒ Ù…Ù…ØªØ¹Ø©ØŒ ÙˆÙ…ÙÙŠØ¯Ø©.
        8. Ø§ØªÙƒÙ„Ù… Ù…ØµØ±ÙŠ 100%ØŒ Ù…ÙÙŠØ´ ÙØµØ­Ù‰ ÙˆÙ„Ø§ Ø£Ù„Ù‚Ø§Ø¨ Ø²ÙŠ "ÙŠØ§ Ø¨Ø§Ø´Ø§" Ø£Ùˆ "ÙŠØ§ ÙÙ†Ø¯Ù…".
        """}]

        for role, text in history:
            messages.append({"role": role, "content": text})

        user_content = [{"type": "text", "text": user_message or "ÙÙŠÙ‡ ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©"}]
        if image_b64:
            user_content.append({
                "type": "image_url",
                "image_url": {"url": f"data:image/jpeg;base64,{image_b64}"}
            })

        messages.append({"role": "user", "content": user_content})

        reply = openai_chat(messages)

        conversation_history[user_ip].append(("user", user_message or "[ØµÙˆØ±Ø©]"))
        conversation_history[user_ip].append(("assistant", reply))
        if len(conversation_history[user_ip]) > 10:
            conversation_history[user_ip] = conversation_history[user_ip][-10:]

        return jsonify({
            "reply": reply,
            "city": city,
            "type": "chat",
            "has_image": bool(image_b64)
        })

    except Exception as e:
        print(f"Ø®Ø·Ø£ Ø¹Ø§Ù…: {e}")
        return jsonify({"error": "ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø©ØŒ Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ"}), 500

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))

    app.run(host="0.0.0.0", port=port, debug=False)



